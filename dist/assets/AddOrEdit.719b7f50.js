import{a as N,h as t,bn as H,$ as J,aC as P,a0 as s,I as k,bz as U,T as W,bp as Y,dh as Z,S as $,F as K,bA as Q,b as X,aW as v,b9 as f,m as p,cj as T,k as ee,bP as te,a4 as ne,di as re,cY as ae,cZ as ie,az as x,G as O,E as I,ag as A,ah as w,C as de,n as F,O as ue,ba as y,a8 as ge}from"./index.416e00a4.js";import{T as d}from"./item_type.be442da4.js";import{R as le}from"./ResponsiveGrid.d4380b8a.js";const b=e=>{const g=N();return t(Q,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[t(H,{get for(){return e.name},display:"flex",alignItems:"center",get children(){var i;return g(((i=e.full_name_path)!=null?i:e.driver==="common")?`storages.common.${e.name}`:`drivers.${e.driver}.${e.name}`)}}),t(J,{get fallback(){return t(P,{get children(){return g("settings.unknown_type")}})},get children(){return[t(s,{get when(){return e.type===d.String},get children(){return t(k,{get id(){return e.name},get type(){return e.name=="password"?"password":"text"},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===d.String?i=>{var a;return(a=e.onChange)==null?void 0:a.call(e,i.currentTarget.value)}:void 0}})}}),t(s,{get when(){return e.type===d.Number},get children(){return t(k,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===d.Number?i=>{var a;return(a=e.onChange)==null?void 0:a.call(e,parseInt(i.currentTarget.value))}:void 0}})}}),t(s,{get when(){return e.type===d.Bool},get children(){return t(U,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get onChange(){return e.type===d.Bool?i=>{var a;return(a=e.onChange)==null?void 0:a.call(e,i.currentTarget.checked)}:void 0}})}}),t(s,{get when(){return e.type===d.Text},get children(){return t(W,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===d.Text?i=>{var a;return(a=e.onChange)==null?void 0:a.call(e,i.currentTarget.value)}:void 0}})}}),t(s,{get when(){return e.type===d.Select},get children(){return t(Y,{get id(){return e.name},get readOnly(){return e.readonly},get defaultValue(){return e.value},get onChange(){return e.type===d.Select?i=>{var a;return(a=e.onChange)==null?void 0:a.call(e,i)}:void 0},get children(){return t(Z,{get readonly(){return e.readonly},get searchable(){return e.type===d.Select&&e.searchable},get options(){return e.options.split(",").map(i=>{var a;return{key:i,label:g(((a=e.options_prefix)!=null?a:e.driver==="common"?`storages.common.${e.name}s`:`drivers.${e.driver}.${e.name}s`)+`.${i}`)}})}})}})}})]}}),t($,{get when(){return e.help},get children(){return t(K,{get children(){return g(e.driver==="common"?`storages.common.${e.name}-tips`:`drivers.${e.driver}.${e.name}-tips`)}})}})]}})};function L(e,g){switch(e){case d.Bool:return g?g==="true":!1;case d.Number:return g?parseInt(g):0;default:return g||""}}const he=()=>{const e=N(),{params:g,back:i,to:a}=X(),{id:l}=g,[R,B]=v(()=>f.get("/admin/driver/list"),!0),[c,C]=p({}),j=async()=>{const n=await B();y(n,C)},[D,E]=v(()=>f.get(`/admin/storage/get?id=${l}`),!0),[M,q]=v(()=>f.get(`/admin/driver/info?driver=${u.driver}`),!0);l?(async()=>{const n=await E();y(n,async r=>{o(r),m(JSON.parse(r.addition));const h=await q();y(h,z=>C({[u.driver]:z}))})})():j();const[u,o]=T({}),[S,m]=T({}),[G,V]=v(()=>(o("addition",JSON.stringify(S)),f.post(`/admin/storage/${l?"update":"create"}`,u))),_=ee(()=>{var r;const n=(r=c()[u.driver])==null?void 0:r.config.alert;if(console.log(n),n)return n.split("|")[0]});return t(ge,{get loading(){return l?D()||M():R()},get children(){return[t(te,{mb:"$2",get children(){return e(`global.${l?"edit":"add"}`)}}),t(ne,{mb:"$2",spacing:"$2",get children(){return[t(b,{name:"driver",default:"",readonly:l!==void 0,required:!0,searchable:!0,get type(){return d.Select},get options(){return l?u.driver:Object.keys(c()).join(",")},get value(){return u.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:n=>{for(const r of c()[n].common)o(r.name,L(r.type,r.default));m(re(r=>{for(const h in r)delete r[h]}));for(const r of c()[n].additional)m(r.name,L(r.type,r.default));o("driver",n)}}),t($,{get when(){return _()},get children(){return t(ae,{get status(){return _()},w:"$full",get children(){return[t(ie,{}),x(()=>e(`drivers.config.${u.driver}.alert`))]}})}})]}}),t(le,{get children(){return[t($,{get when(){return c()[u.driver]},get children(){return[t(O,{get each(){return c()[u.driver].common},children:n=>t(b,I(n,{driver:"common",get readonly(){return x(()=>n.name=="user_id",!0)()&&!A.is_admin(w())},get value(){return u[n.name]},onChange:r=>{o(n.name,r)}}))}),t(O,{get each(){return c()[u.driver].additional},children:n=>t(b,I(n,{get driver(){return u.driver},get value(){return S[n.name]},onChange:r=>{m(n.name,r)}}))})]}}),t($,{when:l,get children(){return t(b,{name:"user_id",get default(){return w().id.toString()},get readonly(){return!A.is_admin(w())},get type(){return d.Number},options:"",get value(){return u.user_id},onChange:n=>{o("user_id",n)}})}})]}}),t(de,{mt:"$2",get loading(){return G()},onClick:async()=>{c()[u.driver].config.need_ms&&(F.info(e("manage.add_storage-tips")),window.open(ue("/@manage/messenger"),"_blank"));const n=await V();y(n,()=>{F.success(e("global.save_success")),i()},(r,h)=>{n.data.id&&a(`/@manage/storages/edit/${n.data.id}`)})},get children(){return e(`global.${l?"save":"add"}`)}})]}})};export{he as default};
