import{c8 as se,E as D,c9 as N,ca as k,ai as j,X as z,h as e,a7 as R,aJ as v,U as S,b as J,c4 as m,cb as _,e as ae,ax as W,b9 as C,bX as ie,cc as le,cd as ce,ce as ue,cf as ge,a as de,k as pe,m as f,cg as he,aW as P,a4 as fe,bQ as T,au as me,bP as we,S as w,I as U,ch as F,b5 as be,ae as Ce,C as O,bk as _e,bl as $e,ci as xe,aC as Se,bG as A,n as b,ba as ke}from"./index.0f370c1d.js";import{a as ve}from"./useTitle.08df2766.js";import{s as ye,g as Ie,a as Ge}from"./webauthn-json.browser-ponyfill.1c672167.js";const Le="https://github.com/alist-org/alist";function Ee(s){return se(`${s}-${Le}`)}var Re=j('<svg version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink height=896 width=967.8852157128662><defs><path id=path-2 opacity=1 fill-rule=evenodd d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id=linearGradient-3 x1=0.5 y1=0 x2=0.5 y2=1><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use xlink:href=#path-2 fill=url(#linearGradient-3) fill-opacity=1>');const Pe=s=>{const u=D({startColor:"#28aff0",endColor:"#120fc4"},s);return(()=>{var n=Re(),c=n.firstChild,g=c.firstChild,o=g.nextSibling,l=o.firstChild,a=l.nextSibling;return N(t=>{var i=u.startColor,d=u.endColor;return i!==t.e&&k(l,"stop-color",t.e=i),d!==t.t&&k(a,"stop-color",t.t=d),t},{e:void 0,t:void 0}),n})()};var Te=j('<svg height=1337 width=1337><defs><path id=path-1 opacity=1 fill-rule=evenodd d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id=linearGradient-2 x1=0.79 y1=0.62 x2=0.21 y2=0.86><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use xlink:href=#path-1 fill=url(#linearGradient-2) fill-opacity=1>');const Ue=s=>{const u=D({startColor:"#28aff0",endColor:"#120fc4"},s);return(()=>{var n=Te(),c=n.firstChild,g=c.firstChild,o=g.nextSibling,l=o.firstChild,a=l.nextSibling;return N(t=>{var i=u.startColor,d=u.endColor;return i!==t.e&&k(l,"stop-color",t.e=i),d!==t.t&&k(a,"stop-color",t.t=d),t},{e:void 0,t:void 0}),n})()},Oe=()=>{const s=z("#a9c6ff","#062b74");return e(R,{get bgColor(){return s()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[e(R,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return e(Ue,{})}}),e(R,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return e(Pe,{})}})]}})},ze=()=>{const s=v("sso_login_enabled"),u=S("sso_login_platform"),n=v("sso_compatibility_mode"),{searchParams:c,to:g}=J(),o=c.token;o!=null&&o!=""&&(m(o),g(decodeURIComponent(c.redirect||_||"/"),!0));function l(a){const t=a.data;t.token&&(m(t.token),g(decodeURIComponent(c.redirect||_||"/"),!0))}if(window.addEventListener("message",l),ae(()=>{window.removeEventListener("message",l)}),s){const a=()=>{const i=C.getUri()+"/auth/sso?method=sso_get_token";if(n){window.location.href=i;return}window.open(i,"authPopup","width=500,height=600")};let t;switch(u){case"Github":t=ge;break;case"Microsoft":t=ue;break;case"Google":t=ce;break;case"Dingtalk":t=le;break;default:t=ie}return e(W,{cursor:"pointer",boxSize:"$8",as:t,p:"$0_5",onclick:a})}},Ae=()=>{const s=S("logo").split(`
`),u=z(s[0],s.pop()),n=de(),c=pe(()=>`${n("login.login_to")} ${S("site_title")}`);ve(c);const g=z("white","$neutral1"),[o,l]=f(localStorage.getItem("username")||""),[a,t]=f(localStorage.getItem("password")||""),[i,d]=f(""),[$,H]=f(!1),[x,K]=he("remember-pwd","false"),[y,M]=f(!1),[V,X]=P(async()=>y()?C.post("/auth/login/ldap",{username:o(),password:a(),otp_code:i()}):C.post("/auth/login/hash",{username:o(),password:Ee(a()),otp_code:i()})),[,Z]=P((r,p,h)=>C.post("/authn/webauthn_finish_login?username="+h,JSON.stringify(p),{headers:{session:r}})),[,q]=P(r=>C.get("/authn/webauthn_begin_login?username="+r)),{searchParams:I,to:G}=J(),Q=v("webauthn_login_enabled"),Y=async()=>{H(!$())},L=async()=>{if($()){if(!ye()){b.error(n("users.webauthn_not_supported"));return}m(),x()==="true"?localStorage.setItem("username",o()):localStorage.removeItem("username");const r=await q(o());ke(r,async p=>{try{const h=Ie(p.options),ne=await Ge(h),re=await Z(p.session,ne,o());A(re,oe=>{b.success(n("login.success")),m(oe.token),G(decodeURIComponent(I.redirect||_||"/"),!0)})}catch(h){h instanceof Error&&b.error(h.message)}})}else{x()==="true"?(localStorage.setItem("username",o()),localStorage.setItem("password",a())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const r=await X();A(r,p=>{b.success(n("login.success")),m(p.token),G(decodeURIComponent(I.redirect||_||"/"),!0)},(p,h)=>{!E()&&h===402?ee(!0):b.error(p)})}},[E,ee]=f(!1),B=v("ldap_login_enabled"),te=S("ldap_login_tips");return B&&M(!0),e(Se,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(fe,{get bgColor(){return g()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(T,{alignItems:"center",justifyContent:"space-around",get children(){return[e(me,{mr:"$2",boxSize:"$12",get src(){return u()}}),e(we,{color:"$info9",fontSize:"$2xl",get children(){return c()}})]}}),e(w,{get when(){return!E()},get fallback(){return e(U,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return i()},onInput:r=>d(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&L()}})},get children(){return[e(U,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return o()},onInput:r=>l(r.currentTarget.value)}),e(w,{get when(){return!$()},get children(){return e(U,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return a()},onInput:r=>t(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&L()}})}}),e(T,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(F,{get checked(){return x()==="true"},onChange:()=>K(x()==="true"?"false":"true"),get children(){return n("login.remember")}}),e(be,{as:"a",target:"_blank",get href(){return n("login.forget_url")},get children(){return n("login.forget")}})]}})]}}),e(Ce,{w:"$full",spacing:"$2",get children(){return[e(w,{get when(){return!$()},get children(){return e(O,{colorScheme:"primary",w:"$full",onClick:()=>{E()?d(""):(l(""),t(""))},get children(){return n("login.clear")}})}}),e(O,{w:"$full",get loading(){return V()},onClick:L,get children(){return n("login.login")}})]}}),e(w,{when:B,get children(){return e(F,{w:"$full",get checked(){return y()===!0},onChange:()=>M(!y()),children:te})}}),e(O,{w:"$full",colorScheme:"accent",onClick:()=>{m(),G(decodeURIComponent(I.redirect||_||"/"),!0)},get children(){return n("login.use_guest")}}),e(T,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(_e,{}),e($e,{}),e(ze,{}),e(w,{when:Q,get children(){return e(W,{cursor:"pointer",boxSize:"$8",as:xe,p:"$0_5",onclick:Y})}})]}})]}}),e(Oe,{})]}})};export{Ae as default};
